<UserControl x:Class="Rogue.NET.Scenario.Content.Views.LevelCanvas"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="LightCoral">
    
    <Border BorderBrush="White" 
            Background="#0F0000FF" 
            CornerRadius="5" 
            BorderThickness="1" 
            Margin="5, 2, 5, 5" 
            Padding="10">
        
        <!-- Clip Rendering Inside Padded Region -->
        <Border ClipToBounds="True" Background="Transparent" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
            
            <Grid>

                <!-- Wall Layer -->
                <Canvas   x:Name="WallCanvas"                  
                          Background="Transparent"
                          HorizontalAlignment="Stretch"
                          VerticalAlignment="Stretch"
                          OpacityMask="{Binding ExploredOpacityMask}">
                    <ContentPresenter Content="{Binding WallLayout}" />
                </Canvas>

                <!-- Door Layer -->
                <Canvas   x:Name="DoorCanvas"
                  OpacityMask="{Binding ExploredOpacityMask}"
                  Background="Transparent"
                  HorizontalAlignment="Stretch"
                  VerticalAlignment="Stretch">
                    <ContentPresenter Content="{Binding DoorLayout}" />
                </Canvas>

                <!-- Revealed Layer -->
                <Canvas   x:Name="RevealedCanvas"
                  OpacityMask="{Binding RevealedOpacityMask}"
                  Background="Transparent"
                  HorizontalAlignment="Left"
                  VerticalAlignment="Top">
                    <ContentPresenter Content="{Binding RevealedLayout}" />
                </Canvas>

                <!-- Light Radii-->
                <ItemsControl x:Name="LightRadiiItemsControl"
                  ItemsSource="{Binding LightRadii}" 
                  OpacityMask="{Binding VisibleOpacityMask}"                      
                  DisplayMemberPath="Symbol"
                  BorderBrush="Transparent" 
                  BorderThickness="0"
                  HorizontalAlignment="Stretch"
                  VerticalAlignment="Stretch">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <Canvas ClipToBounds="False"  />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                </ItemsControl>

                <!-- Auras -->
                <ItemsControl x:Name="AuraItemsControl"
                  ItemsSource="{Binding Auras}" 
                  OpacityMask="{Binding VisibleOpacityMask}"
                  DisplayMemberPath="Symbol"
                  BorderBrush="Transparent" 
                  BorderThickness="0"
                  HorizontalAlignment="Stretch"
                  VerticalAlignment="Stretch">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <Canvas ClipToBounds="False" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                </ItemsControl>

                <!-- Doodads -->
                <ItemsControl x:Name="DoodadItemsControl"
                      ItemsSource="{Binding Doodads}" 
                      BorderBrush="Transparent" 
                      BorderThickness="0"
                      HorizontalAlignment="Stretch"
                      VerticalAlignment="Stretch">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <Canvas ClipToBounds="False" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                </ItemsControl>

                <!-- Items -->
                <ItemsControl x:Name="ItemItemsControl"
                      ItemsSource="{Binding Items}" 
                      BorderBrush="Transparent" 
                      BorderThickness="0"
                      HorizontalAlignment="Stretch"
                      VerticalAlignment="Stretch">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <Canvas ClipToBounds="False" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                </ItemsControl>

                <!-- Characters (Except Player) -->
                <ItemsControl x:Name="CharacterItemsControl"
                      ItemsSource="{Binding Characters}" 
                      BorderBrush="Transparent" 
                      BorderThickness="0"
                      HorizontalAlignment="Stretch"
                      VerticalAlignment="Stretch">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <Canvas ClipToBounds="False" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                </ItemsControl>

                <!-- Player -->
                <Canvas   x:Name="PlayerCanvas"                  
                          Background="Transparent"
                          HorizontalAlignment="Stretch"
                          VerticalAlignment="Stretch">
                    <ContentPresenter Canvas.Left="{Binding Player.Location.X}"
                                      Canvas.Top="{Binding Player.Location.Y}"
                                      Content="{Binding Player}" />
                </Canvas>

                <!-- Animations -->
                <!-- TODO: Split animations into two layers: one for screen blink, and one for opacity mask -->
                <ItemsControl x:Name="AnimationItemsControl"
                      ItemsSource="{Binding Animations}" 
                      BorderBrush="Transparent" 
                      BorderThickness="0"
                      HorizontalAlignment="Stretch"
                      VerticalAlignment="Stretch">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <Canvas ClipToBounds="False" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                </ItemsControl>

            </Grid>
        </Border>
    </Border>
</UserControl>